{
  "version": 3,
  "sources": ["../../../dist/src/lib/motia-analytics.js"],
  "sourcesContent": ["import { useCallback } from 'react';\nclass WorkbenchAnalytics {\n    constructor() {\n        Object.defineProperty(this, \"isInitialized\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        Object.defineProperty(this, \"userIdCache\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: null\n        });\n        Object.defineProperty(this, \"projectIdCache\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: null\n        });\n        Object.defineProperty(this, \"motiaVersion\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: null\n        });\n        this.initialize();\n    }\n    async initialize() {\n        if (typeof window !== 'undefined' && window.amplitude) {\n            await this.fetchUserData();\n            this.isInitialized = true;\n            this.identifyUser();\n        }\n    }\n    async fetchUserData() {\n        try {\n            const response = await fetch('/motia/analytics/user');\n            if (response.ok) {\n                const data = await response.json();\n                this.userIdCache = data.userId;\n                this.projectIdCache = data.projectId;\n                this.motiaVersion = data.motiaVersion;\n                window.amplitude.setOptOut(!data.analyticsEnabled);\n                // Set the user ID in Amplitude to match backend\n                if (window.amplitude && data.userId) {\n                    window.amplitude.setUserId(data.userId);\n                }\n            }\n            else {\n                console.warn('Failed to fetch user data from backend, using fallback');\n                this.userIdCache = this.generateFallbackUserId();\n            }\n        }\n        catch (error) {\n            console.warn('Error fetching user data:', error);\n            this.userIdCache = this.generateFallbackUserId();\n        }\n    }\n    generateFallbackUserId() {\n        let userId = localStorage.getItem('motia-user-id');\n        if (!userId) {\n            userId = `user-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n            localStorage.setItem('motia-user-id', userId);\n        }\n        return userId;\n    }\n    identifyUser() {\n        if (!this.isInitialized || !this.userIdCache)\n            return;\n        try {\n            window.amplitude.identify(this.userIdCache, {\n                project_id: this.projectIdCache,\n                browser: this.getBrowserInfo(),\n                screen_resolution: `${window.screen.width}x${window.screen.height}`,\n                workbench_version: this.motiaVersion,\n            });\n        }\n        catch (error) {\n            console.warn('Analytics user identification failed:', error);\n        }\n    }\n    getBrowserInfo() {\n        const ua = navigator.userAgent;\n        if (ua.includes('Chrome'))\n            return 'Chrome';\n        if (ua.includes('Firefox'))\n            return 'Firefox';\n        if (ua.includes('Safari'))\n            return 'Safari';\n        if (ua.includes('Edge'))\n            return 'Edge';\n        return 'Unknown';\n    }\n    // Method to get current user and project IDs for external use\n    getAnalyticsIds() {\n        return {\n            userId: this.userIdCache,\n            projectId: this.projectIdCache,\n        };\n    }\n    // Simple track method that preserves the user binding\n    track(eventName, properties) {\n        if (!this.isInitialized)\n            return;\n        const eventProperties = {\n            project_id: this.projectIdCache,\n            source: 'frontend',\n            ...properties,\n        };\n        try {\n            window.amplitude.track(eventName, eventProperties);\n        }\n        catch (error) {\n            console.warn('Analytics tracking failed:', error);\n        }\n    }\n}\nexport const motiaAnalytics = new WorkbenchAnalytics();\nexport const useAnalytics = () => {\n    const track = useCallback((eventName, properties) => {\n        motiaAnalytics.track(eventName, properties);\n    }, []);\n    const getAnalyticsIds = useCallback(() => {\n        return motiaAnalytics.getAnalyticsIds();\n    }, []);\n    return {\n        track,\n        getAnalyticsIds,\n    };\n};\n"],
  "mappings": "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",
  "names": []
}
