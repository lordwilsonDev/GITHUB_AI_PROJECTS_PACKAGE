import {
  require_react
} from "./chunk-IP6FQFDQ.js";
import {
  __toESM
} from "./chunk-7D4SUZUM.js";

// node_modules/@motiadev/workbench/dist/src/lib/motia-analytics.js
var import_react = __toESM(require_react());
var WorkbenchAnalytics = class {
  constructor() {
    Object.defineProperty(this, "isInitialized", {
      enumerable: true,
      configurable: true,
      writable: true,
      value: false
    });
    Object.defineProperty(this, "userIdCache", {
      enumerable: true,
      configurable: true,
      writable: true,
      value: null
    });
    Object.defineProperty(this, "projectIdCache", {
      enumerable: true,
      configurable: true,
      writable: true,
      value: null
    });
    Object.defineProperty(this, "motiaVersion", {
      enumerable: true,
      configurable: true,
      writable: true,
      value: null
    });
    this.initialize();
  }
  async initialize() {
    if (typeof window !== "undefined" && window.amplitude) {
      await this.fetchUserData();
      this.isInitialized = true;
      this.identifyUser();
    }
  }
  async fetchUserData() {
    try {
      const response = await fetch("/motia/analytics/user");
      if (response.ok) {
        const data = await response.json();
        this.userIdCache = data.userId;
        this.projectIdCache = data.projectId;
        this.motiaVersion = data.motiaVersion;
        window.amplitude.setOptOut(!data.analyticsEnabled);
        if (window.amplitude && data.userId) {
          window.amplitude.setUserId(data.userId);
        }
      } else {
        console.warn("Failed to fetch user data from backend, using fallback");
        this.userIdCache = this.generateFallbackUserId();
      }
    } catch (error) {
      console.warn("Error fetching user data:", error);
      this.userIdCache = this.generateFallbackUserId();
    }
  }
  generateFallbackUserId() {
    let userId = localStorage.getItem("motia-user-id");
    if (!userId) {
      userId = `user-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
      localStorage.setItem("motia-user-id", userId);
    }
    return userId;
  }
  identifyUser() {
    if (!this.isInitialized || !this.userIdCache)
      return;
    try {
      window.amplitude.identify(this.userIdCache, {
        project_id: this.projectIdCache,
        browser: this.getBrowserInfo(),
        screen_resolution: `${window.screen.width}x${window.screen.height}`,
        workbench_version: this.motiaVersion
      });
    } catch (error) {
      console.warn("Analytics user identification failed:", error);
    }
  }
  getBrowserInfo() {
    const ua = navigator.userAgent;
    if (ua.includes("Chrome"))
      return "Chrome";
    if (ua.includes("Firefox"))
      return "Firefox";
    if (ua.includes("Safari"))
      return "Safari";
    if (ua.includes("Edge"))
      return "Edge";
    return "Unknown";
  }
  // Method to get current user and project IDs for external use
  getAnalyticsIds() {
    return {
      userId: this.userIdCache,
      projectId: this.projectIdCache
    };
  }
  // Simple track method that preserves the user binding
  track(eventName, properties) {
    if (!this.isInitialized)
      return;
    const eventProperties = {
      project_id: this.projectIdCache,
      source: "frontend",
      ...properties
    };
    try {
      window.amplitude.track(eventName, eventProperties);
    } catch (error) {
      console.warn("Analytics tracking failed:", error);
    }
  }
};
var motiaAnalytics = new WorkbenchAnalytics();
var useAnalytics = () => {
  const track = (0, import_react.useCallback)((eventName, properties) => {
    motiaAnalytics.track(eventName, properties);
  }, []);
  const getAnalyticsIds = (0, import_react.useCallback)(() => {
    return motiaAnalytics.getAnalyticsIds();
  }, []);
  return {
    track,
    getAnalyticsIds
  };
};
export {
  motiaAnalytics,
  useAnalytics
};
//# sourceMappingURL=@_lib_motia-analytics.js.map
